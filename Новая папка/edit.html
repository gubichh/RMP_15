<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–º–µ—Ç–∫–∏</title>
    <style>
        :root{--phone-bg:#111;--screen:#f4f6fb;--white:#fff;--line:#e6e9f2;--muted:#8a91a3;--accent:#ffcc00}
        *{box-sizing:border-box}
        html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--phone-bg);display:flex;align-items:center;justify-content:center}
        .phone{width:375px;background:var(--screen);border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.5);overflow:hidden}
        .top{position:sticky;top:0;background:var(--white);border-bottom:1px solid var(--line);padding:10px 12px;display:flex;gap:8px;align-items:center}
        .btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 10px;font-weight:800;cursor:pointer}
        .btn.yellow{background:var(--accent);border-color:#e0b700}
        .title{width:100%;font-size:18px;border:0;outline:0;background:transparent}
        .page{padding:12px}
        .toolbar{position:sticky;bottom:0;background:var(--white);border-top:1px solid var(--line);display:flex;gap:6px;flex-wrap:wrap;padding:8px}
        .tool{flex:1 1 18%;text-align:center;border:1px solid var(--line);border-radius:10px;padding:8px 0;background:#fff;cursor:pointer}
        .field{background:var(--white);border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:10px}
        textarea{width:100%;border:0;outline:0;resize:vertical;min-height:140px;font-size:14px}
        .check{display:flex;align-items:center;gap:8px;margin-bottom:6px}
        .meta{margin:6px 2px 0;color:#9aa0a6;font-size:12px}
    </style>
</head>
<body>
<main class="phone">
    <div class="top">
        <button class="btn" id="back">–ù–∞–∑–∞–¥</button>
        <input id="title" class="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
        <button class="btn yellow" id="save">–ì–æ—Ç–æ–≤–æ</button>
    </div>

    <div class="page">
        <div class="field">
            <div class="meta">–¢–µ–∫—Å—Ç</div>
            <textarea id="text" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å‚Ä¶"></textarea>
        </div>

        <div class="field" id="checks">
            <div class="meta">–ß–µ–∫-–ª–∏—Å—Ç</div>
            <div class="check"><input type="checkbox"> <input class="cl" placeholder="–ü—É–Ω–∫—Ç‚Ä¶"></div>
        </div>

        <div class="field">
            <div class="meta">–°—Å—ã–ª–∫–∏ (–ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ)</div>
            <textarea id="links" placeholder="https://example.com"></textarea>
        </div>
    </div>

    <div class="toolbar">
        <button class="tool" id="addCheck">‚òëÔ∏é</button>
        <button class="tool" id="h1">Aa</button>
        <button class="tool" id="bold">B</button>
        <button class="tool" id="ital">I</button>
        <button class="tool" id="photo">üñº</button>
        <button class="tool" id="delete" style="flex-basis:100%">–£–¥–∞–ª–∏—Ç—å</button>
    </div>
</main>

<script src="notes.js"></script>
<script>
    const id = new URL(location.href).searchParams.get('id');
    let note = Notes.get(id) || {id, title:'', text:'', checklist:[], links:[], pinned:false, updatedAt:Date.now()};

    const $ = s=>document.querySelector(s);
    $('#title').value = note.title || '';
    $('#text').value = note.text || '';
    $('#links').value = (note.links||[]).join('\n');

    function renderChecklist(){
        const wrap = document.getElementById('checks');
        wrap.querySelectorAll('.check').forEach((_,i)=> i>0 && _.remove());
        (note.checklist||[]).forEach(item=>{
            const row = document.createElement('div');
            row.className='check';
            row.innerHTML = `<input type="checkbox" ${item.done?'checked':''}>
                     <input class="cl" value="${item.text.replace(/"/g,'&quot;')}">`;
            wrap.appendChild(row);
        });
    }
    renderChecklist();

    document.getElementById('addCheck').onclick=()=>{
        note.checklist = note.checklist||[];
        note.checklist.push({text:'',done:false});
        renderChecklist();
    };

    document.getElementById('save').onclick=()=>{
        note.title = $('#title').value.trim()||'–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
        note.text = $('#text').value;
        note.links = $('#links').value.split('\n').map(s=>s.trim()).filter(Boolean);
        // —Å–æ–±—Ä–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç –∏–∑ DOM
        note.checklist = Array.from(document.querySelectorAll('.check')).slice(1).map(row=>{
            return { done: row.querySelector('input[type="checkbox"]').checked,
                text: row.querySelector('.cl').value.trim() };
        });
        note.updatedAt = Date.now();
        Notes.save(note);
        location.href='note.html?id='+encodeURIComponent(note.id);
    };

    document.getElementById('delete').onclick=()=>{
        if(confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É?')){ Notes.remove(note.id); location.href='index.html';}
    };

    document.getElementById('back').onclick=()=>history.length>1?history.back():location.href='index.html';


    document.getElementById('bold').onclick=()=>document.execCommand('bold');
    document.getElementById('ital').onclick=()=>document.execCommand('italic');
</script>
</body>
</html>
